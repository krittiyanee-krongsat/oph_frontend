<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <div id="questions"></div><br/><br/>
    <button id="submitButton">Submit</button>

    <script>
        $(document).ready(function() {

            var questionsData = [];
            
            var qa_array = [];

            // Fetch questions and answers from the server
            for(let id=1; id <= 5; id++){
                $.ajax({
                    url: "http://localhost:5000/qa_question/"+id,
                    method: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        questionsData.push(data);
                        if (questionsData.length === 5) {
                            displayQuestions();
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error("AJAX Error: ", status, error);
                    }
                });
            }
        
            function displayQuestions() {
                var $questions = $("<div></div>");
        
                $.each(questionsData, function(index, questionData) {
                    var question_list = questionData.question_list;
                    var answers = questionData.answers_list[0];
        
                    $.each(question_list, function(index, questionItem) {
                        var $questionContainer = $('<div></div>');
                        
                        // Append question text
                        $questionContainer.append(
                            $('<span></span>').val(questionItem.qa_id).text(questionItem.q_student)
                        );
        
                        // Determine if question is a checkbox or radio button
                        var inputType = (questionItem.qa_id === 1 || questionItem.qa_id === 5) ? 'checkbox' : 'radio';
                        
                        $.each(answers, function(index, answerItem) {
                            var $label = $('<label></label>');
                            var $input = $('<input type="' + inputType + '" name="answer' + questionItem.qa_id + '">').val(answerItem.ans_id);
        
                            $label.append($input).append(answerItem.answer);
                            $questionContainer.append('<br>').append($label);
                        });
        
                        $questions.append($questionContainer).append('<br>');
                    });
                });
        
                $('#questions').html($questions);
            }
        
            $('#submitButton').click(function() {
                var qa_answers = {};
                var temp = [];
        
                $('#questions span').each(function() {
                    
                    var questionId = $(this).val();
                    var selectedAnswers = [];
                    temp = [];
                    qa_answers = {};
        
                    // Collect all selected answers for this question
                    $('#questions input[name="answer' + questionId + '"]:checked').each(function() {
                        selectedAnswers.push($(this).val());
                    });
        
                    if (selectedAnswers.length > 0) {
                        qa_answers['qa_id'] = questionId;
                        qa_answers['ans_id'] = selectedAnswers;
                        
                        temp.push(qa_answers);
                        qa_array.push(temp);
                        console.log(temp)
                        
                    }
                });

                var formatJson = {
                    "user_id": 1,
                    "ans_list": qa_array
                }
                
                qa_array['ans_list'] = temp;
                console.log(JSON.stringify(formatJson));
                
        
                $.ajax({
                    url: 'http://localhost:5000/qa_transaction',
                    method: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(qa_answers)
                }).always(function (response) {
                    console.log(response);
                    alert('Success');
                });
        
                return false;
            });
        });
        
    </script>
</body>
</html>








