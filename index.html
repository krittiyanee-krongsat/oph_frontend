<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Account</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Register Account</h1>

    <input type="text" id="emailUser" placeholder="Enter email"><br/><br/>

    <select id="ageDropdown">
        <option value="">Select Age</option>
    </select><br/><br/>

    <select id="genderDropdown">
        <option value="">Select Gender</option>
    </select><br/><br/>
    
    <select id="statusDropdown">
        <option value="">Select Status</option>
    </select><br/><br/>

    <select id="degreeDropdown">
        <option value="">Select Level</option>
    </select><br/><br/>

    <input type="text" id="field_study_input" placeholder="Enter field of study"><br/><br/>

    <select id="province_Dropdown">
        <option value="">Select province</option>
    </select><br/><br/>

    <button id="submitButton">Submit</button>

    <script>
        $(document).ready(async function() {
            const apiUrl = "https://deepseaoph2024.bu.ac.th/api/";

            // Function to populate dropdowns
            async function populateDropdown(url, dropdownId, valueKey, textKey) {
                try {
                    const response = await fetch(apiUrl + url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    const $dropdown = $(dropdownId);
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item[valueKey]).text(item[textKey])
                        );
                    });
                } catch (error) {
                    console.error(`Error fetching ${url}:`, error);
                }
            }

            // Populate all dropdowns
            await populateDropdown("register_age", "#ageDropdown", "age_id", "age_name");
            await populateDropdown("register_gender", "#genderDropdown", "gender_id", "gender_name");
            await populateDropdown("register_status", "#statusDropdown", "status_id", "status_name");
            await populateDropdown("register_degree", "#degreeDropdown", "degree_id", "degree_name");
            await populateDropdown("register_province", "#province_Dropdown", "province_id", "province_name");

            // Handle submit button click
            $('#submitButton').click(async function(event) {
                event.preventDefault(); // Prevent page refresh

                const email_name = $('#emailUser').val().trim();
                const age_id = $('#ageDropdown').val();
                const gender_id = $('#genderDropdown').val();
                const status_id = $('#statusDropdown').val(); 
                const degree_id = $('#degreeDropdown').val(); 
                const field_study_name = $('#field_study_input').val().trim();
                const province_id = $('#province_Dropdown').val();

                try {
                    const response = await $.ajax({
                        url: apiUrl + 'register_user',
                        method: 'POST',
                        dataType: 'json',
                        contentType: 'application/json', // Specify content type as JSON
                        data: JSON.stringify({
                            email_name: email_name,
                            age_id: age_id,
                            gender_id: gender_id,
                            status_id: status_id,
                            degree_id: degree_id,
                            field_study_name: field_study_name,
                            province_id: province_id
                        })
                    });
                    console.log(response);
                    alert('Registration successful');
                } catch (error) {
                    console.error("AJAX Error: ", error);
                    alert('Failed to register. Please try again.');
                }
            });
        });
    </script>
</body>
</html>












