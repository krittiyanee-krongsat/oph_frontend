<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Account</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Register Account</h1>
    <script>

        var a = "Hello";
        var apiUrl = "http://localhost:5000/";
        //var apiUrl = "http://10.119.16.43/api/";

        
        /*var json;
        
        async function getData(){
            const url="http://localhost:8000/register_age";
            try{
                const response = await fetch(url);
                if(!response.ok){
                    throw new Error (`Response status: ${response.status}`);
                }
                json = await response.json();
                console.log(json);
                return json;

            } catch (error) {
                console.error(error.message);
            }
        }
        console.log("Hello");
        getData();
        const res = JSON.parse(json);
        
        console.log(res);
        for(const key in res){
            if(res.hasOwnProperty(key)){
                console.log(`${key}:${res[key]}`)
            }
        }*/

    </script>

    <input type="text" id="emailUser" placeholder="Enter email"><br/><br/>

    <select id="ageDropdown">
        <option value="">Select Age</option>
    </select><br/><br/>

    <select id="genderDropdown">
        <option value="">Select Gender</option>
    </select><br/><br/>
    
    <select id="statusDropdown">
        <option value="">Select Status</option>
    </select><br/><br/>
    
    <select id="degreeDropdown">
        <option value="">Select Level</option>
    </select><br/><br/>

    <select id="field_study_Dropdown">
        <option value="">Select field of study</option>
    </select><br/><br/>

    <input type="text" id="field_study_input" placeholder="Enter field of study"><br/><br/>

    <select id="province_Dropdown">
        <option value="">Select province</option>
    </select><br/><br/>

    <button id="submitButton">Submit</button>

    <script>
        $(document).ready(function() {

            // ดึงข้อมูลจาก email
            $.ajax({
                url: apiUrl+"register_email",
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var $dropdown = $('#emailUser');
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item.email_id).text(item.email_id)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });

            // ดึงข้อมูลจาก register_age
            $.ajax({
                url: apiUrl+"register_age",
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var $dropdown = $('#ageDropdown');
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item.age_id).text(item.age_name)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });

            // ดึงข้อมูลจาก register_gender
            $.ajax({
                url: apiUrl+"register_gender",
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var $dropdown = $('#genderDropdown');
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item.gender_id).text(item.gender_name)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });
            
            // ดึงข้อมูลจาก register_status
            $.ajax({
                url: apiUrl+"register_status",
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var $dropdown = $('#statusDropdown');
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item.status_id).text(item.status_name)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });
            
            // ดึงข้อมูลจาก register_level
            $.ajax({
                url: apiUrl+"register_degree",
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var $dropdown = $('#degreeDropdown');
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item.degree_id).text(item.degree_name)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });
            
            // ดึงข้อมูลจาก register_field_study
            $.ajax({
                url: apiUrl+"register_field_study",
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var $dropdown = $('#field_study_Dropdown');
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item.field_study_id).text(item.field_study_name)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });
            
            // ดึงข้อมูลจาก register_province
            $.ajax({
                url: apiUrl+"register_province",
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var $dropdown = $('#province_Dropdown');
                    $.each(data, function(index, item) {
                        $dropdown.append(
                            $('<option></option>').val(item.province_id).text(item.province_name)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });
            
            // ฟังการคลิกปุ่ม Submit
            $('#submitButton').click(function() {
                // ดึงข้อมูลจาก form หรือ dropdown
                var email_name = $('#emailUser').val().trim();
                var age_id = $('#ageDropdown').val();
                var gender_id = $('#genderDropdown').val();
                var status_id = $('#statusDropdown').val(); 
                var degree_id =  $('#degreeDropdown').val(); 
               // ตรวจสอบว่า field_study_input มีค่าหรือไม่
               var field_study_name = $('#field_study_input').val().trim();
               if (field_study_name === "") {
                   field_study_name = $('#field_study_Dropdown').val();
               }
                var province_id = $('#province_Dropdown').val();
                //var registered_date = new Date().toISOString();
               console.log(email_name);
                    $.ajax({
                    url: apiUrl+'register_user',
                    method: 'POST',
                    dataType: 'json', //datatype ที่ส่งมาเป็นรูปแบบ json
                    data: {
                        email_name:email_name,
                        age_id: age_id,
                        gender_id:gender_id,
                        status_id: status_id,
                        degree_id: degree_id,
                        field_study_name: field_study_name,
                        province_id: province_id,
                    }
                }).always(function (response) {
                    console.log(response);
                    alert('success');
                })
                return false;
                });
            });
    </script>
</body>
</html>











