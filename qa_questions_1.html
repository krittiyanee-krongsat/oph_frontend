<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    
    <div id="questions"></div>
    
    <div id="ansDropdown_1"></div>

    <button id="submitButton">Submit</button>

    <script>
        
       $(document).ready(function() {
        
        // ประกาศค่าให้กำหนดเลือกคำตอบแค่ 0 ถึง 1
        var selectionCount = 0;
        var maxSelections = 9;
        var selectedAnswers = []; // ใช้ array นี้เพื่อเก็บคำตอบที่เลือกและลำดับของมัน
        
        // ส่งคำขอ AJAX เพื่อดึงข้อมูลจากฐานข้อมูล
        for(let id=1; id <= 5; id++){
        $.ajax({
            url: "http://localhost:5000/qa_question/"+id,
            method: 'GET',
            dataType: 'json',
            success: function(data) {
            
            var question_list = data.question_list;
            var answers = data.answers_list[0];
            //var $questionStudent = $('#question_'+id+'_student');
            //var $questionParent = $('#question_'+id+'_parent');
            
            var $questions = document.createElement("div");
            var $dropdown = document.createElement("div");

            $.each(question_list, function(index, questionItem) {
                        $questions.append(
                            $('<span></span>').val(questionItem.qa_id).text(questionItem.q_student)
                        );

                        $.each(answers, function(index, answerItem) {
                            var $label = $('<label></label>');
                            var $input = $('<input type="radio">').val(answerItem.ans_id);
                            
                            /*$input.on('change', function() {
                                var value = $(this).val();
                                
                                if ($(this).is(':checked')) {
                                    if (selectionCount < maxSelections) { //เช็คเงื่อนไขว่าให้เลือกได้แค่ 1 คำตอบ
                                        selectedAnswers.push(value);
                                        selectionCount++;
                                    } else { //ถ้าเกิน 1 คำตอบจะให้ขึ้นว่าคุณสามารถเลือกได้สูงสุดหนึ่งตัวเลือกเท่านั้น
                                        alert("คุณสามารถเลือกได้สูงสุดสามตัวเลือกเท่านั้น");
                                        $(this).prop('checked', false); // ยกเลิกการเลือกถ้าจำนวนที่เลือกเกิน
                                        return;
                                    }
                                } else {
                                    //ค้นหาตำแหน่งของ value ในอาร์เรย์ selectedAnswers และเก็บตำแหน่งนั้นไว้ในตัวแปร index
                                    var index = selectedAnswers.indexOf(value);
                                    //ตรวจสอบว่า value นั้นมีอยู่ใน selectedAnswers หรือไม่ (ถ้า index มากกว่า -1 แสดงว่ามีอยู่)
                                    if (index > -1) {
                                        //ถ้ามีอยู่ใน selectedAnswers จะลบ value นั้นออกจากอาร์เรย์โดยใช้ splice ซึ่งจะลบออก 1 ค่า ที่ตำแหน่ง index
                                        selectedAnswers.splice(index, 1);
                                        //ลดค่าตัวแปร selectionCount ลง 1 เพื่อแสดงจำนวนคำตอบที่ถูกเลือกที่ลดลง
                                        selectionCount--;
                                    }
                                }
                            });*/
            
                            $label.append($input).append(answerItem.answer);
                            //$dropdown.append($label).append('<br>');
                        });
                    
                    })
                    
                    document.getElementById("questions").innerHTML = $questions;
                    document.getElementById("questions").append($dropdown);
                    
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error: ", status, error);
            }
        });
    }

        /*$.ajax({
            url: "http://localhost:5000/qa_question/1",
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                // รับค่า answer array
                
                // แสดงผล answer ใน html
                
                
                // ใช้ฟังก์ชัน $.each ของ jQuery เพื่อวนลูปผ่านอาร์เรย์ answers
                // ประกาศค่าฟังก์ชัน label กับ input
                // index คือดัชนีของแต่ละรายการในอาร์เรย์ answerItem คือค่าของแต่ละรายการในอาร์เรย์
                
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error: ", status, error);
            }
        });*/
        
        // ฟังการคลิกปุ่ม Submit
        $('#submitButton').click(function() {
            // ดึงข้อมูลจาก form หรือ dropdown
            var qa_id = $('#question_1_student span').val();
            
            $.ajax({
                url: 'http://localhost:5000/qa_transaction',
                method: 'POST',
                dataType: 'json', //datatype ที่ส่งมาเป็นรูปแบบ json
                data: {
                    qa_id: qa_id,
                    ans_id: selectedAnswers.join('')
                }
            }).always(function (response) {
                console.log(response);
                alert('Success');
            });
            
            return false;
        });

    }); 
    </script>

</body>
</html>
