<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA_1</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    
    <label id="question_1_student"></label><br/><br/>

    <label id="question_1_parent"></label><br/><br/>
    
    <select id="ansDropdown_1">
        <option value="">Select Answer</option>
    </select><br/><br/>

    <button id="submitButton">Submit</button>

    <script>
        
       $(document).ready(function() {
        // ส่งคำขอ AJAX เพื่อดึงข้อมูลจากฐานข้อมูล
        $.ajax({
            url: "http://localhost:5000/qa_question/1",
            method: 'GET',
            dataType: 'json',
            success: function(data) {
            
            var question_list = data.question_list;

            var $questionStudent = $('#question_1_student');
            var $questionParent = $('#question_1_parent');

            $.each(question_list, function(index, questionItem) {
                        $questionStudent.append(
                            $('<span></span>').attr('data-qa-id', questionItem.qa_id).text(questionItem.q_student)
                        );

                        $questionParent.append(
                                $('<span></span>').attr('data-qa-id', questionItem.qa_id).text(questionItem.q_parent)
                        )
                    })
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error: ", status, error);
            }
        });

        $.ajax({
                url: "http://localhost:5000/qa_question/1",
                method: 'GET',
                dataType: 'json',
                success: function(data) {

                    //ดึงข้อมูลคำตอบแบบ array
                    var answer = data.answers_list[0];

                    //แสดงคำตอบใน HTML
                    var $dropdown = $('#ansDropdown_1');

                    $.each(answer, function(index, answerItem) {
                        $dropdown.append(
                            $('<option></option>').val(answerItem.ans_id).text(answerItem.answer)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error: ", status, error);
                }
            });
            
        }); 
            // ฟังการคลิกปุ่ม Submit
            $('#submitButton').click(function() {
                // ดึงข้อมูลจาก form หรือ dropdown
                var qa_id = $('#question_1_student span').attr('data-qa-id');
                var ans_id = $('#ansDropdown_1').val();

                console.log(qa_id)
                console.log(ans_id)
                
                    $.ajax({
                    url: 'http://localhost:5000/qa_transaction',
                    method: 'POST',
                    dataType: 'json', //datatype ที่ส่งมาเป็นรูปแบบ json
                    data: {
                        qa_id:qa_id,
                        ans_id:ans_id,
                    }
                }).always(function (response) {
                    console.log(response);
                    alert('success');
                })
                return false;
            });

    </script>

</body>
</html>